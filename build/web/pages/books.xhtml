<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title></title>
    </h:head>
    <h:body>
        <ui:composition template="/templates/aFullPage.xhtml">
            <ui:define name="title">  
                #{messages.index_title}
            </ui:define>
            <ui:define name="content">
                <p:growl life="3000" id="growlMessage" globalOnly="true"/> 

                



                <h:form id="contentForm">                                                                                     

                    <p:dataTable id="tableOfBooks" value="#{bookListController.bookListDataModel}" var="book" lazy="true" paginator="true" emptyMessage=""
                                 styleClass="books_list" rows="5" paginatorAlwaysVisible="false" paginatorTemplate="{RowsPerPageDropdown} {PageLinks}" rowsPerPageTemplate="5,10,15,20" binding="#{bookListController.dataGrid.dataTable}">
                        <p:column styleClass="col1">
                            <h:outputLink value="#{request.contextPath}/PdfReader" target="_blank">
                                <p:graphicImage alt="#{messages.book_cover}" value="/ImageShower?index=#{bookListController.pager.rowIndex}" width="160px" height="220px" cache="false">                                
                                </p:graphicImage>
                                <f:param name="book" value="#{book.id}"/>
                                <f:param name="action" value="read"/>
                                <f:param name="bookName" value="#{book.name}"/>
                            </h:outputLink>
                        </p:column>
                        <p:column styleClass="col2">
                            <div>

                                <h3>
                                    <strong> 
                                        <h:outputText value="#{book.name}" rendered="#{!book.isEditing}"/>
                                    </strong>
                                </h3>
                                <p>
                                    <strong>
                                        <h:outputText value="#{messages.book_name}:" rendered="#{bookListController.isEditorMode and book.isEditing}"/>
                                    </strong>
                                    <h:inputText value="#{book.name}" rendered="#{bookListController.isEditorMode and book.isEditing}"/>
                                </p>                                                                                               
                                <p>
                                    <strong>#{messages.author}: </strong>
                                    <h:outputText value="#{book.author.fio}" rendered="#{!book.isEditing}"/>
                                    <h:selectOneMenu value="#{book.author}" rendered="#{bookListController.isEditorMode and book.isEditing}" converter="#{authorController}">
                                        <f:selectItems value="#{authorController.selectItems}"/>
                                    </h:selectOneMenu>
                                </p>                                      
                                <p>
                                    <strong>#{messages.genre}: </strong>
                                    <h:outputText value="#{book.genre.name}" rendered="#{!book.isEditing}"/>
                                    <h:selectOneMenu  value="#{book.genre}" rendered="#{bookListController.isEditorMode and book.isEditing}" converter="#{genreController}">
                                        <f:selectItems value="${genreController.selectItems}"/>
                                    </h:selectOneMenu>
                                </p> 
                                <p>
                                    <strong>#{messages.page_count}: </strong>
                                    <h:outputText value="#{book.pageCount} #{messages.pages}" rendered="#{!book.isEditing}"/>
                                    <h:inputText value="#{book.pageCount}" styleClass="pages_edit" rendered="#{bookListController.isEditorMode and book.isEditing}"/>
                                </p>
                                <p>
                                    <strong>#{messages.publisher}: </strong>
                                    <h:outputText value="#{book.publisher.name}" rendered="#{!book.isEditing}"/>
                                    <h:selectOneMenu  value="#{book.publisher}" rendered="#{bookListController.isEditorMode and book.isEditing}" converter="#{publisherController}">
                                        <f:selectItems value="${publisherController.selectItems}"/> 
                                    </h:selectOneMenu>
                                </p>
                                <p>
                                    <strong>#{messages.publish_year}: </strong>
                                    <h:outputText value="#{book.publishYear} Ğ³." rendered="#{!book.isEditing}"/>
                                    <h:inputText value="#{book.publishYear}" styleClass="publisher_edit" rendered="#{bookListController.isEditorMode and book.isEditing}"/>
                                </p>
                                <p>
                                    <strong>#{messages.isbn}: </strong> 
                                    <h:outputText value="#{book.isbn}" rendered="#{!book.isEditing}"/>
                                    <h:inputText value="#{book.isbn}" styleClass="name_edit" rendered="#{bookListController.isEditorMode and book.isEditing}"/>
                                </p>
                                <p>
                                    <strong>
                                        <h:outputLink value="#{request.contextPath}/PdfReader" rendered="#{!book.isEditing}">
                                            <h:outputText value="#{messages.read}"/>
                                            <f:param name="book" value="#{book.id}"/>
                                            <f:param name="action" value="read"/>
                                            <f:param name="bookName" value="#{book.name}"/>
                                        </h:outputLink>
                                    </strong>
                                    <strong>
                                        <h:outputLink value="#{request.contextPath}/PdfReader" rendered="#{!book.isEditing}">
                                            <h:outputText value="#{messages.download}"/>
                                            <f:param name="book" value="#{book.id}"/>
                                            <f:param name="action" value="download"/>
                                            <f:param name="bookName" value="#{book.name}"/>
                                        </h:outputLink>
                                    </strong>
                                </p>
                            </div>
                        </p:column>
                        <p:column styleClass="col3">
                            <div class="book_details">
                                <p><strong>#{messages.book_description}</strong></p>
                                <h:outputText value="#{book.descr}" rendered="#{!book.isEditing}"/>
                                <h:inputTextarea value="#{book.descr}" styleClass="descr_edit" rendered="#{bookListController.isEditorMode and book.isEditing}"/>
                            </div>
                        </p:column>

                        <p:column>
                            <p:commandLink actionListener="#{bookListController.switchEditMode}" title="#{messages.Edit}" update=":formEditBook:bookDetails" >  
                                <h:graphicImage library="images" name="edit.jpg" />
                                <f:setPropertyActionListener value="#{book}"  target="#{bookListController.selectedBook}" />  
                            </p:commandLink> 


                            <p:commandLink title="#{messages.delete}" type="button" onclick="PF('dlgDeleteBook').show()" >  
                                <h:graphicImage library="images" name="delete.gif" />
                                <f:setPropertyActionListener value="#{book}"  target="#{bookListController.selectedBook}" /> 
                            </p:commandLink>                              
                        </p:column>
                    </p:dataTable>
                    <p:confirmDialog widgetVar="dlgDeleteBook" message="#{messages.delete_confirm}?" width="300px" styleClass="dialog_delete">    
                        <h:panelGrid columns="2" style="margin:0 auto; width:150px;">
                            <p:commandButton id="btnDeletedBook" value="#{messages.yes}" action="#{bookListController.deleteBook}" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" update=":contentForm:tableOfBooks :booksCountOutputText :growlMessage" onclick="PF('dlgDeleteBook').hide()" ajax="false"/>  
                            <p:commandButton value="#{messages.no}" styleClass="ui-confirmdialog-no" icon="ui-icon-close" onclick="PF('dlgDeleteBook').hide()" type="button" ajax="false"/>       
                        </h:panelGrid>
                    </p:confirmDialog>  
                   
                </h:form>                
            </ui:define>            
            <ui:define name="books_count">
                <h:outputText id="booksCountOutputText" value="#{messages.found_books} #{bookListController.pager.totalBooksCount}"/>
            </ui:define>
        </ui:composition>
    </h:body>
</html>


